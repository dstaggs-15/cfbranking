<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>CFB Top 25 â€” In-Season Metrics</title>
<style>
:root{--bg:#0b111a;--panel:#121826;--panel2:#0f1420;--text:#eaf0f7;--muted:#9fb0c4;--brand:#5eead4;--accent:#a78bfa;--r:16px;--shadow:0 10px 28px rgba(0,0,0,.45)}
*{box-sizing:border-box}html,body{height:100%}
body{margin:0;background:
  radial-gradient(1200px 600px at 20% -10%, #1a2440 0%, transparent 60%),
  radial-gradient(1000px 500px at 120% 10%, #1b2746 0%, transparent 60%),
  var(--bg);
  color:var(--text);font:16px/1.55 system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif}
.container{max-width:1100px;margin:0 auto;padding:1.2rem}
.site-header{border-bottom:1px solid rgba(255,255,255,.06);background:linear-gradient(180deg, rgba(255,255,255,.04), transparent)}
.site-header h1{margin:.25rem 0 0;font-weight:800;letter-spacing:.2px}
.sub{margin:.25rem 0 1rem;color:var(--muted)}
.updated{margin:.25rem 0 1rem;color:var(--accent)}
.btn{appearance:none;border:0;cursor:pointer;padding:.55rem .9rem;border-radius:10px;font-weight:600;background:var(--brand);color:#041016;box-shadow:var(--shadow)}
.btn.secondary{background:transparent;color:var(--text);border:1px solid rgba(255,255,255,.15)}
.btn.secondary:hover{border-color:rgba(255,255,255,.35)}
.about{margin-top:.8rem;background:var(--panel);border-radius:var(--r);padding:1rem 1.2rem;border:1px solid rgba(255,255,255,.09)}
.about pre{background:var(--panel2);padding:.6rem;border-radius:10px;overflow:auto}
.hidden{display:none}
.grid{display:grid;gap:1rem;grid-template-columns:repeat(auto-fill,minmax(280px,1fr));margin:1.5rem 0 2.5rem}
.card{background:linear-gradient(180deg, rgba(255,255,255,.045), rgba(255,255,255,.02));border:1px solid rgba(255,255,255,.08);border-radius:var(--r);padding:1rem 1.1rem;box-shadow:var(--shadow);transition:transform .15s,border-color .15s,background .15s;cursor:pointer}
.card:hover{transform:translateY(-3px);border-color:rgba(255,255,255,.18)}
.row1{display:flex;align-items:center;gap:.75rem;margin-bottom:.25rem}
.rank-badge{width:42px;height:42px;border-radius:50%;display:grid;place-items:center;font-weight:800;background:var(--brand);color:#041016}
.team{font-size:1.06rem;font-weight:700;letter-spacing:.2px}
.score{color:var(--muted);font-size:.92rem}
.details{margin-top:.6rem;padding-top:.6rem;border-top:1px dashed rgba(255,255,255,.12);color:#cfd7e3;font-size:.94rem}
.kv{display:grid;grid-template-columns:1fr auto;gap:.25rem .5rem}
.kv div:nth-child(odd){color:var(--muted)}
.kv div:nth-child(even){font-weight:600}
.empty{text-align:center;background:var(--panel);border:1px dashed rgba(255,255,255,.12);color:var(--muted);padding:1.25rem;border-radius:var(--r)}
.error{background:#371a1a;border:1px solid #6b1d1d;color:#ffd8d8;padding:.8rem 1rem;border-radius:10px;margin:1rem 0}
.site-footer{border-top:1px solid rgba(255,255,255,.06);background:linear-gradient(0deg, rgba(255,255,255,.04), transparent);color:var(--muted)}
</style>
</head>
<body>
<header class="site-header">
  <div class="container">
    <h1>CFB Top 25 â€” In-Season Metrics</h1>
    <p class="sub">Win% â€¢ Strength of Schedule â€¢ Scoring Margin</p>
    <p id="updated" class="updated"></p>
    <button id="about-toggle" class="btn secondary">ðŸ“˜ About these rankings</button>
    <div id="about" class="about hidden">
      <p>This model is 100% data-driven â€” no polls and no preseason bias. Each teamâ€™s weekly score is:</p>
      <pre><code>Score = 0.55 Ã— Win%  +  0.30 Ã— Strength of Schedule  +  0.15 Ã— (Average Margin Ã· 25)</code></pre>
      <ul>
        <li><b>Win%</b>: games won / games played</li>
        <li><b>Average Margin</b>: (points for âˆ’ points against) per game</li>
        <li><b>Strength of Schedule</b>: mean opponent Win% among teams already played</li>
      </ul>
      <p>Data updates automatically from the CFBD API whenever the workflow runs.</p>
    </div>
  </div>
</header>

<main class="container">
  <div id="error" class="error hidden"></div>
  <div id="rankings" class="grid"></div>
  <div id="empty" class="empty hidden">No rankings available yet. Check back after games complete.</div>
</main>

<footer class="site-footer">
  <div class="container">
    Built with CFBD data â€¢ No preseason bias â€¢ Auto-updated
  </div>
</footer>

<script>
function renderCard(entry, index){
  const sosPct = (entry.sos ?? 0) * 100;
  const avgMargin = (entry.avg_margin ?? entry.avgMargin ?? 0);
  return `
    <article class="card" tabindex="0" aria-expanded="false">
      <div class="row1">
        <div class="rank-badge">#${index + 1}</div>
        <div>
          <div class="team">${entry.team}</div>
          <div class="score">Score: ${Number(entry.score).toFixed(3)}</div>
        </div>
      </div>
      <section class="details hidden">
        <div class="kv">
          <div>Record</div><div>${entry.wins}-${entry.losses}</div>
          <div>Avg margin</div><div>${avgMargin}</div>
          <div>Strength of schedule</div><div>${sosPct.toFixed(1)}%</div>
          <div>Points for</div><div>${entry.points_for}</div>
          <div>Points against</div><div>${entry.points_against}</div>
        </div>
      </section>
    </article>`;
}

async function main(){
  const updated = document.getElementById("updated");
  const grid = document.getElementById("rankings");
  const empty = document.getElementById("empty");
  const errorBox = document.getElementById("error");
  const aboutBtn = document.getElementById("about-toggle");
  const about = document.getElementById("about");

  aboutBtn.addEventListener("click", () => about.classList.toggle("hidden"));

  // 1) Try project-relative path (Pages default)
  const tryUrls = [
    "data/rankings.json?cb=" + Date.now(),
    "./data/rankings.json?cb=" + Date.now(),
    "/cfbranking/data/rankings.json?cb=" + Date.now()   // safety net for custom domain
  ];

  let data = null, lastErr = null;
  for (const url of tryUrls){
    try{
      const res = await fetch(url, {cache:"no-store"});
      if(!res.ok) throw new Error(`HTTP ${res.status}`);
      data = await res.json();
      console.log("Loaded JSON from", url);
      break;
    }catch(err){
      lastErr = err;
      console.warn("Failed", url, err);
    }
  }
  if(!data){
    errorBox.classList.remove("hidden");
    errorBox.textContent = "Could not load rankings.json. Looked in: " + tryUrls.join("  |  ") + (lastErr ? `  â€¢ Last error: ${lastErr.message}` : "");
    return;
  }

  updated.textContent = `Last updated ${new Date(data.last_build_utc).toLocaleString()} â€¢ Season ${data.season}`;

  const list = Array.isArray(data.top25) ? data.top25 : [];
  if (list.length === 0){
    empty.classList.remove("hidden");
    return;
  }

  grid.innerHTML = list.map(renderCard).join("");
  grid.querySelectorAll(".card").forEach(card => {
    const details = card.querySelector(".details");
    const toggle = () => {
      details.classList.toggle("hidden");
      card.setAttribute("aria-expanded", details.classList.contains("hidden") ? "false" : "true");
    };
    card.addEventListener("click", toggle);
    card.addEventListener("keypress", e => { if(e.key==="Enter"||e.key===" "){ e.preventDefault(); toggle(); }});
  });
}
main();
</script>
</body>
</html>
