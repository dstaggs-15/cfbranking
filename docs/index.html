<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>CFB Top 25 — Computer Rankings</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    :root {
      --bg: #0b0f14;
      --panel: #131a22;
      --card: #0f1720;
      --text: #e7edf5;
      --muted: #9fb0c3;
      --accent: #37d0b2;
      --ring: #66aaff44;
      --shadow: 0 10px 20px #00000055, inset 0 1px 0 #ffffff10;
    }
    * { box-sizing: border-box; }
    html, body {
      margin: 0;
      color: var(--text);
      background: radial-gradient(1200px 600px at 10% -10%, #0d1320, #091019), #090e14;
      font: 16px/1.5 Inter, ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial, "Apple Color Emoji", "Segoe UI Emoji";
    }
    .container { max-width: 1000px; margin: 0 auto; padding: 0 16px; }
    .row { display:flex; gap:12px; }
    .center { align-items:center; }
    .space-between { justify-content:space-between; }
    .site-header {
      position: sticky; top:0; z-index:5;
      backdrop-filter: blur(10px);
      background: color-mix(in oklab, var(--bg) 70%, transparent);
      border-bottom:1px solid #ffffff10;
    }
    .site-header .container { padding:14px 16px; }
    h1 { font-size:1.25rem; margin:0; letter-spacing:.25px; }
    .btn {
      border: 1px solid #ffffff1a; color: var(--text);
      background: linear-gradient(180deg, #1a2330, #121924);
      padding: 8px 12px; border-radius: 10px; cursor:pointer;
    }
    .btn:hover { border-color:#ffffff33; }
    .btn:focus { outline:3px solid var(--ring); outline-offset:2px; }
    .btn-icon { border:none; background:transparent; color:var(--muted); font-size:1.1rem; cursor:pointer; }
    .btn-icon:hover { color:var(--text); }

    .meta { margin: 22px 0; color: var(--muted); display:flex; gap:18px; flex-wrap:wrap; }
    .rank-list { list-style:none; padding:0; margin:0 0 80px; display:grid; gap:12px; }

    .rank-item {
      background: linear-gradient(180deg, #0d1520, #0b1017);
      border: 1px solid #ffffff10; border-radius:14px; box-shadow: var(--shadow);
      padding: 12px;
    }
    .rank-head { display:grid; grid-template-columns: 36px 1fr auto; gap:10px; align-items:center; }
    .rank-num {
      width:32px; height:32px; display:grid; place-items:center;
      border-radius:8px; background: linear-gradient(180deg, #111a27, #0e1620);
      border:1px solid #ffffff12; color:#cbd7e6; font-weight:700;
    }
    .team-pill {
      display:inline-flex; align-items:center; gap:10px; padding:10px 12px;
      border-radius:12px; background:#122033; border:1px solid #ffffff12;
      cursor:pointer; transition: transform .06s ease;
    }
    .team-pill:hover { transform: translateY(-1px); }
    .team-name { font-weight:800; letter-spacing:.2px; }
    .record { color:#a9b9cd; margin-left:6px; }
    .score { font-weight:800; color: var(--accent); }
    .details { margin-top:12px; border-top:1px dashed #ffffff1a; padding-top:12px; display:none; }
    .grid { display:grid; grid-template-columns: repeat(3,minmax(0,1fr)); gap:12px; }
    .card { background: var(--card); border:1px solid #ffffff10; border-radius:12px; padding:12px; }
    .card h4 { margin:0 0 6px; font-size:0.95rem; color:#d4e4ff; }
    .kv { display:grid; grid-template-columns: 1fr auto; gap:6px; }
    .kv .k { color:#a9b9cd; }
    .kv .v { font-weight:800; text-align:right; }

    dialog { border:none; padding:0; background:transparent; }
    .modal {
      width: min(1000px, 94vw); max-height: 88vh; overflow:auto;
      background: linear-gradient(180deg, #0e1520, #0b1118);
      border:1px solid #ffffff15; border-radius:14px; box-shadow:0 20px 60px #000000aa; padding:16px;
    }
    .modal-header { display:flex; align-items:center; justify-content:space-between; }
    .modal-body h3 { margin-top:18px; }
    .modal-body p, .modal-body li { color:#d5deea; }
    .notice { color:#cfe6ff; background:#10345a; border:1px solid #1f4d80; padding:10px 12px; border-radius:10px; }
    @media (max-width: 840px) { .grid { grid-template-columns: 1fr; } }
  </style>
</head>
<body>
  <header class="site-header">
    <div class="container row space-between center">
      <h1>CFB Top 25</h1>
      <button id="open-explainer" class="btn">How rankings are made</button>
    </div>
  </header>

  <main class="container">
    <section id="meta" class="meta"></section>
    <ol id="rank-list" class="rank-list"></ol>
  </main>

  <!-- Big in-depth explainer (behind a click) -->
  <dialog id="explainer">
    <div class="modal">
      <div class="modal-header">
        <h2>How this ranking works — detailed, plain English</h2>
        <button id="close-explainer" class="btn-icon" aria-label="Close explainer">✕</button>
      </div>
      <div class="modal-body">
        <p class="notice"><strong>No polls. No preseason bias.</strong> We rank teams using only games that have actually been played this season. The goal is to reward results on the field against real competition.</p>

        <h3>1) Which teams are included?</h3>
        <ul>
          <li>Only <strong>FBS</strong> programs (the top division of college football) are ranked.</li>
          <li>Each FBS team’s <strong>record</strong> (wins–losses) includes every game that team played, whether the opponent was FBS or FCS. This keeps the record you see here consistent with what’s shown on TV or score sites.</li>
          <li>However, the résumé math (below) only uses <strong>FBS vs FBS</strong> games, because those are comparable schedules.</li>
        </ul>

        <h3>2) Primary ordering: “loss buckets”</h3>
        <p>Teams are grouped by how many losses they have. Fewer losses always come first. For example, every 5–1 team starts ahead of every 4–2 team before any tiebreakers.</p>

        <h3>3) Head-to-head tiebreaker (inside the same loss bucket)</h3>
        <p>If two teams in the <em>same loss group</em> played each other, the game’s winner is placed ahead of the loser. This avoids the “we beat you but you rank above us” nonsense inside equal loss groups.</p>

        <h3>4) Composite score — orders teams within each loss bucket</h3>
        <p>After enforcing head-to-head, we order the remaining ties using a composite score built from football-common-sense inputs. Here is each piece, in plain terms and exactly how it’s used:</p>
        <ul>
          <li><strong>Winning percentage (50%)</strong> — win the games you play. Calculated as wins divided by total games played.</li>
          <li><strong>Strength of schedule (22%)</strong> — how strong your schedule is, using only FBS vs FBS games. We compute each opponent’s FBS winning percentage, then take the average across your FBS opponents. This yields a number near 0.50 for an average schedule; higher means tougher.</li>
          <li><strong>Average scoring margin (10%)</strong> — by how many points you outscore opponents on average. We cap its impact so blowouts don’t overwhelm the other factors.</li>
          <li><strong>Quality wins (bonus)</strong> — each win over a roughly Top-40 FBS opponent adds a small amount to your score. Top-40 is based on a provisional seed to avoid circular math.</li>
          <li><strong>Bad losses (penalty)</strong> — each loss to a roughly 80-plus opponent subtracts from your score.</li>
          <li><strong>Tiny efficiency seasoning (very small tiebreaker)</strong> — two per-play metrics:
            <ul>
              <li><strong>Predicted Points Added (PPA)</strong>, offense minus defense — how much your offense increases expected points and how much your defense decreases them. Positive differential is good.</li>
              <li><strong>Success Rate</strong>, offense minus defense — how often your plays meet the down-and-distance goal compared to opponents’ success against you. Higher is better.</li>
            </ul>
            These add a gentle nudge in tight cases; they are not decisive by themselves.
          </li>
        </ul>

        <h3>5) Why you won’t see “random” teams up top</h3>
        <ul>
          <li><strong>Schedule strength</strong> and <strong>bad-loss penalties</strong> make soft slates and stumbles show up where they should.</li>
          <li><strong>Head-to-head</strong> inside the same loss group preserves common-sense ordering when teams actually met.</li>
        </ul>

        <h3>6) What the advanced numbers shown on a team card mean</h3>
        <ul>
          <li><strong>PPA (Predicted Points Added)</strong> — Every play shifts the expected points for that drive. Offense PPA says how much your offense increases that expectation per play; Defense PPA says how much your defense reduces the opponent’s expectation. We show these as <em>z-scores within this Top 25 page</em>: 0.00 means average among these 25; +1.00 is one standard deviation better than the group average.</li>
          <li><strong>Success Rate</strong> — The share of plays that “succeed” (gain enough yards to stay ahead of the chains). Again shown as z-scores relative to the Top 25 on the page.</li>
        </ul>

        <h3>7) TL;DR</h3>
        <p>Win a lot. Do it against good teams. Avoid bad losses. Score more than you allow. If two teams have the same number of losses and played each other, the winner goes ahead. That’s it — no brand bias, no preseason inertia.</p>
      </div>
    </div>
  </dialog>

  <script>
    // ====== CONFIG ======
    // If your site lives somewhere else, change this:
    const DATA_URL = "/cfbranking/data/rankings.json?v=3";

    // Team colors (extend as you like)
    const TEAM_COLORS = {
      "Alabama": "#9e0b0f","Georgia":"#cc0000","Ohio State":"#bb0000","Michigan":"#00274c",
      "Texas":"#bf5700","Oregon":"#004f39","Florida State":"#782f40","Notre Dame":"#0c2340",
      "Clemson":"#f56600","LSU":"#461d7c","Ole Miss":"#14213d","Miami":"#005030",
      "Oklahoma":"#841617","Tennessee":"#ff8200","Auburn":"#0a1f44","Penn State":"#041e42",
      "USC":"#990000","Utah":"#cc0000","Texas A&M":"#500000","Washington":"#4b2e83",
      "Florida":"#0021a5","North Carolina":"#7BAFD4","Duke":"#012169","Kansas State":"#512888",
      "Missouri":"#f1b82d","Oklahoma State":"#ff7f00","Texas Tech":"#cc0000","Ole Miss":"#14213d",
      "Oregon State":"#dc4405","Wisconsin":"#c5050c","Iowa":"#000000","Nebraska":"#e41c38",
      "UCLA":"#3284bf","Arizona":"#ab0520","Arizona State":"#8e2a2a","Louisville":"#ad0000",
      "North Carolina State":"#cc0000","Virginia Tech":"#630031","Washington State":"#981e32",
      "Kansas":"#0051ba","Kentucky":"#0033a0","Baylor":"#003015","TCU":"#4d1979","Ole Miss":"#14213d",
      "Ole Miss Rebels":"#14213d","Mississippi State":"#660000","South Carolina":"#73000a",
      "Arkansas":"#9d2235","Ole Miss":"#14213d","Tulane":"#005837","UCF":"#ba9b37"
    };

    // ====== UTIL ======
    const $ = sel => document.querySelector(sel);
    function fmt(n, d = 2) { return (typeof n === "number" && isFinite(n)) ? n.toFixed(d) : "—"; }
    function mean(a){ return a.length ? a.reduce((x,y)=>x+y,0)/a.length : 0; }
    function std(a){ if(a.length<2) return 1; const m=mean(a); const v=mean(a.map(x=>(x-m)*(x-m))); return v===0?1:Math.sqrt(v); }
    function z(val, arr){ const s=std(arr), m=mean(arr); return s===0?0:(val-m)/s; }
    function colorFor(team){ return TEAM_COLORS[team] || "#122033"; }

    async function load() {
      const res = await fetch(DATA_URL, { cache:"no-store" });
      if(!res.ok) throw new Error("Failed to load rankings.json");
      return await res.json();
    }

    function renderMeta({season, last_build_utc}) {
      $("#meta").innerHTML = `
        <div>Season: <strong>${season}</strong></div>
        <div>Last build (UTC): <strong>${last_build_utc}</strong></div>
        <div>Click a team to expand stats.</div>
      `;
    }

    function buildZMap(teams){
      const a = (k)=>teams.map(t=>t[k] ?? 0);
      const m = {};
      const cols = ["off_ppa","def_ppa","off_sr","def_sr"];
      const bases = Object.fromEntries(cols.map(k=>[k,a(k)]));
      for(const t of teams){
        m[t.team] = {
          off_ppa: z(t.off_ppa ?? 0, bases.off_ppa),
          def_ppa: z(t.def_ppa ?? 0, bases.def_ppa),
          off_sr:  z(t.off_sr  ?? 0, bases.off_sr),
          def_sr:  z(t.def_sr  ?? 0, bases.def_sr),
        };
      }
      return m;
    }

    function rowHTML(t, zmap){
      const color = colorFor(t.team);
      const z = zmap[t.team] || {off_ppa:0,def_ppa:0,off_sr:0,def_sr:0};
      return `
        <li class="rank-item" data-team="${t.team}">
          <div class="rank-head">
            <div class="rank-num">${t.rank}</div>
            <button class="team-pill" style="background:${color}22;border-color:${color}66;">
              <span class="team-name" style="color:${color}">${t.team}</span>
              <span class="record">(${t.wins}-${t.losses})</span>
            </button>
            <div class="score">${fmt(t.score,3)}</div>
          </div>
          <div class="details">
            <div class="grid">
              <div class="card">
                <h4>Résumé</h4>
                <div class="kv"><div class="k">Strength of Schedule (FBS-only)</div><div class="v">${fmt(t.sos,3)}</div></div>
                <div class="kv"><div class="k">Average Scoring Margin</div><div class="v">${fmt(t.avg_margin,1)}</div></div>
                <div class="kv"><div class="k">Quality Wins (≈Top-40)</div><div class="v">${t.qual_wins}</div></div>
                <div class="kv"><div class="k">Bad Losses (≈80+)</div><div class="v">${t.bad_losses}</div></div>
              </div>
              <div class="card">
                <h4>Record</h4>
                <div class="kv"><div class="k">Overall</div><div class="v">${t.wins}-${t.losses}</div></div>
                <div class="kv"><div class="k">Points For</div><div class="v">${t.points_for}</div></div>
                <div class="kv"><div class="k">Points Against</div><div class="v">${t.points_against}</div></div>
                <div class="kv"><div class="k">FBS Wins / Losses</div><div class="v">${t.fbs_wins ?? "—"}${t.fbs_wins!==undefined?("-"+(t.fbs_losses??"—")):""}</div></div>
              </div>
              <div class="card">
                <h4>Advanced (z-scores within this Top 25)</h4>
                <div class="kv"><div class="k">Offense: Predicted Points Added</div><div class="v">${fmt(z.off_ppa,2)}</div></div>
                <div class="kv"><div class="k">Defense: Predicted Points Added</div><div class="v">${fmt(z.def_ppa,2)}</div></div>
                <div class="kv"><div class="k">Offense: Success Rate</div><div class="v">${fmt(z.off_sr,2)}</div></div>
                <div class="kv"><div class="k">Defense: Success Rate</div><div class="v">${fmt(z.def_sr,2)}</div></div>
              </div>
            </div>
          </div>
        </li>
      `;
    }

    function bindRowToggles(root){
      root.querySelectorAll(".team-pill").forEach(btn=>{
        const li = btn.closest(".rank-item");
        const details = li.querySelector(".details");
        btn.addEventListener("click", ()=>{
          details.style.display = (details.style.display === "block") ? "none" : "block";
        });
      });
    }

    async function main(){
      // Explainer open/close
      $("#open-explainer").addEventListener("click", ()=> $("#explainer").showModal());
      $("#close-explainer").addEventListener("click", ()=> $("#explainer").close());

      try{
        const data = await load();
        renderMeta(data);

        const teams = data.top25 || [];
        if(!teams.length){
          $("#rank-list").innerHTML = `<li class="rank-item"><div class="rank-head">No rankings available yet.</div></li>`;
          return;
        }
        const zmap = buildZMap(teams);
        $("#rank-list").innerHTML = teams.map(t => rowHTML(t, zmap)).join("");
        bindRowToggles($("#rank-list"));
      }catch(err){
        console.error(err);
        $("#rank-list").innerHTML = `<li class="rank-item"><div class="rank-head">Failed to load rankings.json</div></li>`;
      }
    }
    main();
  </script>
</body>
</html>
